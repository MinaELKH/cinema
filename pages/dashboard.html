<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Cinéma</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-6">


    <nav class="bg-white shadow mb-6">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-600">Cinéma Admin</h1>
            <div class="space-x-4">
                <a href="dashboard.html" class="text-gray-700 hover:text-indigo-600 font-medium">Dashboard</a>
                <a href="manage_film.html" class="text-gray-700 hover:text-indigo-600 font-medium">Gérer Films</a>
                <a href="manage_seance.html" class="text-gray-700 hover:text-indigo-600 font-medium">Gérer Séances</a>
                <a href="manage_salle.html" class="text-gray-700 hover:text-indigo-600 font-medium">Gérer Salles</a>
            </div>
        </div>
    </nav>



    <h1 class="text-3xl font-bold mb-6">Dashboard Cinéma</h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow p-4">
            <h2 class="text-lg font-semibold">Total Films</h2>
            <p id="totalFilms" class="text-2xl font-bold text-indigo-600">0</p>
        </div>
        <div class="bg-white rounded-xl shadow p-4">
            <h2 class="text-lg font-semibold">Total Séances</h2>
            <p id="totalSeances" class="text-2xl font-bold text-indigo-600">0</p>
        </div>
        <div class="bg-white rounded-xl shadow p-4">
            <h2 class="text-lg font-semibold">Total Réservations</h2>
            <p id="totalReservations" class="text-2xl font-bold text-indigo-600">0</p>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow p-4 mb-8">
        <h2 class="text-lg font-semibold mb-2">Taux d’Occupation</h2>
        <table class="w-full text-left border border-gray-200">
            <thead>
                <tr class="bg-gray-100">
                    <th class="p-2 border">Film</th>
                    <th class="p-2 border">Places Réservées</th>
                    <th class="p-2 border">Taux d’Occupation (%)</th>
                </tr>
            </thead>
            <tbody id="tauxOccupationBody"></tbody>
        </table>
    </div>

    <div class="bg-white rounded-xl shadow p-4 mb-8">
        <h2 class="text-lg font-semibold mb-2">Revenus par Film</h2>
        <table class="w-full text-left border border-gray-200">
            <thead>
                <tr class="bg-gray-100">
                    <th class="p-2 border">Film</th>
                    <th class="p-2 border">Tickets Vendus</th>
                    <th class="p-2 border">Revenus (€)</th>
                </tr>
            </thead>
            <tbody id="revenusBody"></tbody>
        </table>
    </div>

    <div class="bg-white rounded-xl shadow p-4">
        <h2 class="text-lg font-semibold mb-2">Top Films Populaires</h2>
        <ul id="filmsPopulaires" class="list-disc pl-6"></ul>
    </div>

    <script>
        fetch('http://127.0.0.1:8000/api/admin/dashboard')
            .then(res => res.json())
            .then(data => {
                document.getElementById('totalFilms').textContent = data.stats.total_films;
                document.getElementById('totalSeances').textContent = data.stats.total_seances;
                document.getElementById('totalReservations').textContent = data.stats.total_reservations;

                const tauxBody = document.getElementById('tauxOccupationBody');
                data.tauxOccupation.forEach(e => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-2 border">${e.titre}</td>
                        <td class="p-2 border">${e.places_reservees}</td>
                        <td class="p-2 border">${parseFloat(e.taux_occupation).toFixed(2)}%</td>
                    `;
                    tauxBody.appendChild(row);
                });

                const revenusBody = document.getElementById('revenusBody');
                data.revenusParFilm.forEach(e => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-2 border">${e.titre}</td>
                        <td class="p-2 border">${e.tickets_vendus}</td>
                        <td class="p-2 border">${parseFloat(e.revenus_total).toFixed(2)} €</td>
                    `;
                    revenusBody.appendChild(row);
                });

                const list = document.getElementById('filmsPopulaires');
                data.filmsPopulaires.forEach(film => {
                    const li = document.createElement('li');
                    li.textContent = `${film.titre} (${film.nombre_reservations} réservations)`;
                    list.appendChild(li);
                });
            })
            .catch(err => {
                console.error('Erreur lors de la récupération des stats :', err);
            });
    </script>
</body>
</html>
